#!/bin/sh -eu

# a way to get static pattern rules *without* GNU make

rm -f config.mk

# everybody uses a lexer

for fmt in words lisp csv
do
cat >> config.mk <<EOF
$fmt.lex.c $fmt.lex.h : $fmt.l
	\$(LEX) \$(LFLAGS) --header-file=$fmt.lex.h --outfile=$fmt.lex.c $fmt.l

driver_$fmt : driver_$fmt.o parsers.a
driver_$fmt.o : driver_$fmt.c $fmt.h $fmt.lex.h

EOF
done

# and some user a parser too

for fmt in lisp csv
do
cat >> config.mk <<EOF
$fmt.tab.c $fmt.tab.h : $fmt.y
	\$(YACC) \$(YFLAGS) -d -b $fmt $fmt.y
driver_$fmt.o : $fmt.tab.h

$fmt.lex.c $fmt.lex.h : $fmt.tab.h

EOF
done
